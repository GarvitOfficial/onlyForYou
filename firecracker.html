<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Diwali - Firecracker Animation</title>
    <script>
        // Check if user has decoded name, if not redirect to secretcode.html
        window.addEventListener('DOMContentLoaded', () => {
            const decodedName = localStorage.getItem('decodedName');
            if (!decodedName) {
                window.location.href = 'secretcode.html';
            } else {
                document.title = `Happy Diwali ${decodedName} - Firecracker Animation`;
            }
        });
    </script>
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #000428 0%, #004e92 50%, #1a1a2e 100%);
            font-family: 'Arial', sans-serif;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
        
        .firecracker {
            cursor: pointer;
        }
        
        .explosion-particle {
            opacity: 0;
        }
        
        .diwali-text {
            opacity: 0;
            font-family: 'Georgia', serif;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .sparkle {
            opacity: 0;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .star {
            animation: twinkle 2s infinite;
        }
        
        /* Back to Home button */
        .nav-home {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        .nav-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <a href="index.html" class="nav-home">‚Üê Back to Home</a>
    <svg viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
        <defs>
            <!-- Night sky gradient -->
            <radialGradient id="skyGradient" cx="50%" cy="30%">
                <stop offset="0%" stop-color="#1a1a2e"/>
                <stop offset="50%" stop-color="#16213e"/>
                <stop offset="100%" stop-color="#0f0f23"/>
            </radialGradient>
            
            <!-- Firecracker gradient -->
            <linearGradient id="crackerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#ff6b6b"/>
                <stop offset="30%" stop-color="#ffd93d"/>
                <stop offset="70%" stop-color="#ff6b6b"/>
                <stop offset="100%" stop-color="#c44569"/>
            </linearGradient>
            
            <!-- Explosion gradients -->
            <radialGradient id="explosionCenter">
                <stop offset="0%" stop-color="#fff" stop-opacity="1"/>
                <stop offset="20%" stop-color="#ffd700" stop-opacity="0.9"/>
                <stop offset="50%" stop-color="#ff6b6b" stop-opacity="0.7"/>
                <stop offset="100%" stop-color="#ff1744" stop-opacity="0"/>
            </radialGradient>
            
            <!-- Text gradient -->
            <linearGradient id="textGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ffd700"/>
                <stop offset="25%" stop-color="#ff6b6b"/>
                <stop offset="50%" stop-color="#ffd700"/>
                <stop offset="75%" stop-color="#ff6b6b"/>
                <stop offset="100%" stop-color="#ffd700"/>
            </linearGradient>
        </defs>
        
        <!-- Night sky background -->
        <rect width="100%" height="100%" fill="url(#skyGradient)"/>
        
        <!-- Stars -->
        <g id="stars">
            <circle cx="100" cy="80" r="1.5" fill="#fff" class="star" style="animation-delay: 0s"/>
            <circle cx="200" cy="120" r="1" fill="#ffd700" class="star" style="animation-delay: 0.5s"/>
            <circle cx="350" cy="90" r="1.2" fill="#fff" class="star" style="animation-delay: 1s"/>
            <circle cx="500" cy="110" r="0.8" fill="#ffd700" class="star" style="animation-delay: 1.5s"/>
            <circle cx="650" cy="70" r="1.3" fill="#fff" class="star" style="animation-delay: 2s"/>
            <circle cx="750" cy="130" r="1" fill="#ffd700" class="star" style="animation-delay: 0.3s"/>
            <circle cx="80" cy="200" r="0.9" fill="#fff" class="star" style="animation-delay: 1.2s"/>
            <circle cx="300" cy="180" r="1.1" fill="#ffd700" class="star" style="animation-delay: 0.8s"/>
        </g>
        
        <!-- Ground -->
         <ellipse cx="400" cy="580" rx="400" ry="20" fill="#2d3436" opacity="0.8"/>
         
         <!-- Launch platform -->
          <rect x="390" y="570" width="20" height="10" fill="#654321" rx="2"/>
          <rect x="385" y="575" width="30" height="5" fill="#8b4513" rx="1"/>
          
          <!-- Launch smoke -->
          <g id="launchSmoke" opacity="0">
              <circle cx="400" cy="575" r="8" fill="#666" opacity="0.6"/>
              <circle cx="395" cy="578" r="6" fill="#888" opacity="0.4"/>
              <circle cx="405" cy="578" r="6" fill="#888" opacity="0.4"/>
              <circle cx="400" cy="580" r="10" fill="#999" opacity="0.3"/>
          </g>
          
          <!-- Firecracker -->
          <g id="firecracker" class="firecracker">
             <!-- Firecracker body -->
             <rect x="-8" y="-30" width="16" height="25" fill="url(#crackerGradient)" rx="2"/>
             <!-- Firecracker tip -->
             <polygon points="-8,-30 8,-30 0,-40" fill="#ff1744"/>
             <!-- Fuse -->
             <line x1="0" y1="-40" x2="0" y2="-50" stroke="#8b4513" stroke-width="2"/>
             <!-- Fuse spark -->
             <circle id="fuseSpark" cx="0" cy="-50" r="2" fill="#ffd700" opacity="0">
                 <animate attributeName="opacity" values="0;1;0" dur="0.3s" repeatCount="indefinite" begin="click"/>
             </circle>
         </g>
         
         <!-- Launch trail -->
         <path id="launchTrail" d="M400,570 C400,570 400,400 380,300 Q370,250 400,110" 
               stroke="#ffd700" stroke-width="4" fill="none" opacity="0" stroke-dasharray="6,3">
             <animate id="trailAnimation" attributeName="stroke-dashoffset" 
                      values="0;-500" dur="2s" fill="freeze" begin="indefinite" opacity="0"/>
         </path>
         
         <!-- Trail fade gradient -->
         <linearGradient id="trailFade" x1="0%" y1="100%" x2="0%" y2="0%">
             <stop offset="0%" stop-color="#ffd700" stop-opacity="1"/>
             <stop offset="90%" stop-color="#ffd700" stop-opacity="1"/>
             <stop offset="100%" stop-color="#ffd700" stop-opacity="0"/>
         </linearGradient>
         
         <!-- Trail overlay for smooth fade -->
         <path id="trailOverlay" d="M400,570 C400,570 400,400 380,300 Q370,250 400,110"
               stroke="url(#trailFade)" stroke-width="4" fill="none" opacity="0"/>
         
         <!-- Explosion center -->
         <g id="explosionGroup" transform="translate(400, 110)" opacity="0">
            <!-- Central explosion -->
            <circle id="explosionCenter" r="0" fill="url(#explosionCenter)"/>
            
            <!-- Explosion particles -->
            <g id="particles">
                <!-- Red particles -->
                <g fill="#ff1744">
                    <circle class="explosion-particle" cx="0" cy="0" r="3"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2.5"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="3"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2"/>
                </g>
                <!-- Gold particles -->
                <g fill="#ffd700">
                    <circle class="explosion-particle" cx="0" cy="0" r="2.5"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="3"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2.5"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="3"/>
                </g>
                <!-- Orange particles -->
                <g fill="#ff6b35">
                    <circle class="explosion-particle" cx="0" cy="0" r="2"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2.5"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="3"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2"/>
                    <circle class="explosion-particle" cx="0" cy="0" r="2.5"/>
                </g>
            </g>
            
            <!-- Sparkles -->
            <g id="sparkles">
                <g class="sparkle" fill="#fff">
                    <polygon points="0,-4 1,0 0,4 -1,0"/>
                    <polygon points="-4,0 0,1 4,0 0,-1"/>
                </g>
                <g class="sparkle" fill="#ffd700">
                    <polygon points="0,-3 0.8,0 0,3 -0.8,0"/>
                    <polygon points="-3,0 0,0.8 3,0 0,-0.8"/>
                </g>
            </g>
        </g>
        
        <!-- Diwali Message -->
        <text id="diwalMessage" x="400" y="300" text-anchor="middle" class="diwali-text" 
              font-size="48" fill="url(#textGradient)" stroke="#ff1744" stroke-width="1">
            HAPPY DIWALI <tspan id="nameText">FRIEND</tspan>
        </text>
        
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const decodedName = localStorage.getItem('decodedName');
                if (decodedName) {
                    document.getElementById('nameText').textContent = decodedName.toUpperCase();
                }
            });
        </script>
        
        <!-- Decorative elements around text -->
        <g id="textDecorations" opacity="0">
            <circle cx="150" cy="280" r="3" fill="#ffd700"/>
            <circle cx="650" cy="280" r="3" fill="#ff1744"/>
            <circle cx="180" cy="320" r="2" fill="#ff6b35"/>
            <circle cx="620" cy="320" r="2" fill="#ffd700"/>
            <polygon points="120,300 125,295 130,300 125,305" fill="#ff1744"/>
            <polygon points="670,300 675,295 680,300 675,305" fill="#ffd700"/>
        </g>
    </svg>

    <script>
        const firecracker = document.getElementById('firecracker');
         const launchTrail = document.getElementById('launchTrail');
         const trailOverlay = document.getElementById('trailOverlay');
         const launchSmoke = document.getElementById('launchSmoke');
         const explosionGroup = document.getElementById('explosionGroup');
         const explosionCenter = document.getElementById('explosionCenter');
         const particles = document.querySelectorAll('.explosion-particle');
         const sparkles = document.querySelectorAll('.sparkle');
         const diwalMessage = document.getElementById('diwalMessage');
         const textDecorations = document.getElementById('textDecorations');
        
        firecracker.addEventListener('click', launchFirecracker);
        // Touch support for mobile (Android-friendly)
        firecracker.addEventListener('touchstart', (e) => { e.preventDefault(); launchFirecracker(); });

        // Mobile tweaks: scale text and trail for small screens
        if (window.innerWidth <= 420) {
            diwalMessage.setAttribute('font-size', '32');
            launchTrail.setAttribute('stroke-width', '3');
        }
        
        function launchFirecracker() {
              // Reset all animations
              resetAnimation();
              
              // Show launch smoke
              launchSmoke.style.transition = 'opacity 0.5s ease-out, transform 3s ease-out';
              launchSmoke.style.opacity = '1';
              launchSmoke.style.transform = 'scale(2) translateY(-20px)';
              
              // Fade out smoke
              setTimeout(() => {
                  launchSmoke.style.opacity = '0';
              }, 1000);
              
              // Show and animate launch trail
              launchTrail.style.opacity = '1';
              trailOverlay.style.opacity = '1';
              launchTrail.style.strokeDashoffset = '0';
              launchTrail.style.transition = 'stroke-dashoffset 2s cubic-bezier(0.45, 0, 0.55, 1)';
              
              // Animate trail with overlay for smooth fade
              setTimeout(() => {
                  launchTrail.style.strokeDashoffset = '-500';
                  trailOverlay.style.transition = 'opacity 1s ease-in-out';
                  trailOverlay.style.opacity = '0.8';
              }, 50);
              
              // Animate firecracker launch with realistic curved motion
              firecracker.style.transition = 'transform 2s cubic-bezier(0.45, 0, 0.55, 1)';
              
              // Keyframe animation for curved path
              const keyframes = [
                  { transform: 'translate(400px, 570px) rotate(0deg) scale(1)', offset: 0 },
                  { transform: 'translate(400px, 400px) rotate(-5deg) scale(0.9)', offset: 0.3 },
                  { transform: 'translate(380px, 300px) rotate(-10deg) scale(0.8)', offset: 0.6 },
                  { transform: 'translate(370px, 250px) rotate(-5deg) scale(0.75)', offset: 0.8 },
                  { transform: 'translate(400px, 110px) rotate(0deg) scale(0.7)', offset: 1 }
              ];
              
              firecracker.animate(keyframes, {
                  duration: 2000,
                  easing: 'cubic-bezier(0.45, 0, 0.55, 1)',
                  fill: 'forwards'
              });
              
              // Start explosion with slight overlap for smooth transition
              setTimeout(() => {
                  // Start fading out trail before explosion
                  launchTrail.style.transition = 'opacity 0.3s ease-out';
                  trailOverlay.style.transition = 'opacity 0.3s ease-out';
                  launchTrail.style.opacity = '0';
                  trailOverlay.style.opacity = '0';
                  
                  // Start explosion slightly before trail completely fades
                  setTimeout(() => {
                      explode();
                  }, 200);
              }, 1900);
          }
        
        function explode() {
            // Hide firecracker and trail
            firecracker.style.opacity = '0';
            launchTrail.style.opacity = '0';
            
            // Show explosion group
            explosionGroup.style.opacity = '1';
            
            // Animate explosion center
            explosionCenter.style.transition = 'r 0.5s ease-out';
            explosionCenter.setAttribute('r', '50');
            
            // Animate particles
            particles.forEach((particle, index) => {
                const angle = (index * 360 / particles.length) * Math.PI / 180;
                const distance = 80 + Math.random() * 40;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                particle.style.transition = 'transform 1s ease-out, opacity 1s ease-out';
                particle.style.transform = `translate(${x}px, ${y}px)`;
                particle.style.opacity = '1';
                
                // Fade out particles
                setTimeout(() => {
                    particle.style.opacity = '0';
                }, 500);
            });
            
            // Animate sparkles
            sparkles.forEach((sparkle, index) => {
                setTimeout(() => {
                    const angle = Math.random() * 360 * Math.PI / 180;
                    const distance = 60 + Math.random() * 30;
                    const x = Math.cos(angle) * distance;
                    const y = Math.sin(angle) * distance;
                    
                    sparkle.style.transition = 'transform 1.5s ease-out, opacity 1.5s ease-out';
                    sparkle.style.transform = `translate(${x}px, ${y}px) rotate(${Math.random() * 360}deg)`;
                    sparkle.style.opacity = '1';
                    
                    setTimeout(() => {
                        sparkle.style.opacity = '0';
                    }, 1000);
                }, index * 100);
            });
            
            // Show message after explosion
            setTimeout(() => {
                showMessage();
            }, 800);
        }
        
        function showMessage() {
            // Animate text appearance
            diwalMessage.style.transition = 'opacity 1s ease-in, transform 1s ease-in';
            diwalMessage.style.opacity = '1';
            diwalMessage.style.transform = 'scale(1.1)';
            
            // Show decorations
            textDecorations.style.transition = 'opacity 1s ease-in';
            textDecorations.style.opacity = '1';
            
            // Add pulsing effect to text
            setTimeout(() => {
                diwalMessage.style.animation = 'pulse 2s infinite';
            }, 1000);
        }
        
        function resetAnimation() {
             // Reset firecracker to bottom position
             firecracker.style.transition = 'none';
             firecracker.style.transform = 'translate(400px, 570px) rotate(0deg) scale(1)';
             firecracker.style.opacity = '1';
             
             // Reset trails
              launchTrail.style.transition = 'none';
              trailOverlay.style.transition = 'none';
              launchTrail.style.opacity = '0';
              trailOverlay.style.opacity = '0';
              launchTrail.style.strokeDashoffset = '0';
              
              // Reset smoke
              launchSmoke.style.transition = 'none';
              launchSmoke.style.opacity = '0';
              launchSmoke.style.transform = 'scale(1) translateY(0px)';
             
             // Reset explosion
            explosionGroup.style.opacity = '0';
            explosionCenter.setAttribute('r', '0');
            
            // Reset particles
            particles.forEach(particle => {
                particle.style.transition = 'none';
                particle.style.transform = 'translate(0, 0)';
                particle.style.opacity = '0';
            });
            
            // Reset sparkles
            sparkles.forEach(sparkle => {
                sparkle.style.transition = 'none';
                sparkle.style.transform = 'translate(0, 0)';
                sparkle.style.opacity = '0';
            });
            
            // Reset message
            diwalMessage.style.transition = 'none';
            diwalMessage.style.opacity = '0';
            diwalMessage.style.transform = 'scale(1)';
            diwalMessage.style.animation = 'none';
            
            // Reset decorations
            textDecorations.style.opacity = '0';
        }
        
        // Add CSS animation for pulse effect
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { transform: scale(1.1); }
                50% { transform: scale(1.2); }
            }
        `;
        document.head.appendChild(style);
        
        // Auto-start animation after 1 second
        setTimeout(() => {
            launchFirecracker();
        }, 1000);
    </script>
</body>
</html>